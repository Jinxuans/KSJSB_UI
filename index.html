<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«æ‰‹æé€Ÿç‰ˆç®¡ç†ç•Œé¢</title>
    <!-- Vue 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Element Plus CDN -->
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css" />
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <!-- Element Plus Icons -->
    <script src="https://unpkg.com/@element-plus/icons-vue/dist/index.iife.js"></script>
    <!-- Axios -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <!-- Socket.IO Client -->
    <script src="https://unpkg.com/socket.io-client@4/dist/socket.io.js"></script>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f7fa;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 12px rgba(0,0,0,0.15);
        }
        
        .header h1 {
            margin: 0 0 8px 0;
            font-size: 1.8rem;
            font-weight: 600;
        }
        
        .header p {
            margin: 0;
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px;
        }
        
        .status-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        }
        
        .log-container {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 16px;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            -webkit-overflow-scrolling: touch;
        }
        
        .log-line {
            margin-bottom: 4px;
            word-break: break-word;
        }
        
        .log-error { color: #f56565; }
        .log-warn { color: #ed8936; }
        .log-success { color: #48bb78; }
        .log-info { color: #4299e1; }
        
        /* ç§»åŠ¨ç«¯å“åº”å¼å¸ƒå±€ */
        @media (max-width: 768px) {
            .container {
                padding: 12px;
            }
            
            .status-card {
                padding: 16px;
                margin-bottom: 12px;
            }
            
            .header {
                padding: 16px 12px;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .header p {
                font-size: 0.8rem;
            }
            
            .log-container {
                height: 250px;
                padding: 12px;
                font-size: 12px;
            }
            
            /* ä¼˜åŒ–ç»Ÿè®¡å¡ç‰‡åœ¨ç§»åŠ¨ç«¯çš„æ˜¾ç¤º */
            .el-row {
                margin: 0 !important;
            }
            
            .el-col {
                padding: 0 6px !important;
            }
            
            /* ç§»åŠ¨ç«¯è¡¨æ ¼ä¼˜åŒ– */
            .el-table {
                font-size: 12px;
            }
            
            .el-table th,
            .el-table td {
                padding: 8px 4px;
            }
            
            /* ç§»åŠ¨ç«¯æŒ‰é’®ä¼˜åŒ– */
            .el-button {
                padding: 8px 12px;
                font-size: 13px;
                min-height: 36px;
                border-radius: 6px;
            }
            
            .el-button--small {
                padding: 6px 10px;
                font-size: 12px;
                min-height: 32px;
            }
            
            /* ç§»åŠ¨ç«¯è¡¨å•ä¼˜åŒ– */
            .el-form-item__label {
                font-size: 13px;
                line-height: 1.4;
            }
            
            .el-input__wrapper {
                min-height: 36px;
            }
            
            .el-textarea__inner {
                font-size: 13px;
            }
            
            /* ç§»åŠ¨ç«¯å¯¹è¯æ¡†ä¼˜åŒ– */
            .el-dialog {
                width: 95% !important;
                margin: 0 auto;
                max-width: 500px;
            }
            
            .el-dialog__body {
                padding: 16px 20px;
            }
            
            /* ç§»åŠ¨ç«¯è¡¨å•æ ‡ç­¾ä½ç½®è°ƒæ•´ */
            .el-form--label-top .el-form-item__label {
                padding-bottom: 4px;
                line-height: 1.2;
            }
            
            /* ç§»åŠ¨ç«¯æ ‡ç­¾é¡µä¼˜åŒ– */
            .el-tabs__item {
                padding: 0 12px;
                font-size: 13px;
            }
            
            /* ç§»åŠ¨ç«¯ç»Ÿè®¡æ•°å­—ä¼˜åŒ– */
            .el-statistic__content {
                font-size: 1.5rem !important;
            }
            
            .el-statistic__head {
                font-size: 12px !important;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 8px;
            }
            
            .status-card {
                padding: 12px;
                margin-bottom: 8px;
            }
            
            .header {
                padding: 12px 8px;
            }
            
            .header h1 {
                font-size: 1.3rem;
            }
            
            .log-container {
                height: 200px;
                padding: 8px;
                font-size: 11px;
            }
            
            .el-col {
                padding: 0 3px !important;
            }
            
            .el-button {
                padding: 6px 8px;
                font-size: 12px;
                min-height: 32px;
            }
            
            .el-button--small {
                padding: 4px 6px;
                font-size: 11px;
                min-height: 28px;
            }
        }
        
        /* è§¦æ‘¸å‹å¥½çš„äº¤äº’å…ƒç´  */
        .el-button,
        .el-table__row,
        .el-tabs__item {
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
        }
        
        /* å¤‡æ³¨åˆ—å¼ºè°ƒæ ·å¼ */
        .el-table th.remark-column {
            background: linear-gradient(135deg, #409EFF20 0%, #67C23A20 100%) !important;
            position: relative;
        }
        
        .el-table th.remark-column::before {
            content: "ğŸ“";
            margin-right: 4px;
        }
        
        /* å¤‡æ³¨æ ‡ç­¾åŠ¨ç”»æ•ˆæœ */
        .remark-tag {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .remark-tag:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(64, 158, 255, 0.4) !important;
        }
        
        /* ç§»åŠ¨ç«¯ä¸“ç”¨æ ·å¼ */
        .mobile-stack {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .mobile-button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }
        
        .mobile-button-group .el-button {
            flex: 1;
            min-width: 80px;
        }
        
        .desktop-button-group {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }
        
        .desktop-button-group .el-button {
            min-width: 100px;
        }
        
        /* ç§»åŠ¨ç«¯è¡¨æ ¼å¡ç‰‡åŒ– */
        @media (max-width: 768px) {
            .mobile-table-card {
                display: none;
            }
            
            .mobile-card-view {
                display: block;
            }
            
            .account-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
                padding: 12px;
                margin-bottom: 8px;
            }
            
            .account-card-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 8px;
                padding-bottom: 8px;
                border-bottom: 1px solid #dee2e6;
            }
            
            .account-card-content {
                font-size: 12px;
                line-height: 1.4;
            }
            
            .account-card-content > div {
                margin-bottom: 4px;
            }
            
            .account-card-actions {
                margin-top: 8px;
                display: flex;
                gap: 8px;
            }
        }
        
        @media (min-width: 769px) {
            .mobile-table-card {
                display: table;
            }
            
            .mobile-card-view {
                display: none;
            }
            
            /* æ¡Œé¢ç«¯å¯¹è¯æ¡†ä¼˜åŒ– */
            .el-dialog {
                margin-top: 8vh !important;
                margin-bottom: 8vh !important;
                max-height: 84vh;
                border-radius: 12px;
                box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
            }
            
            .el-dialog__header {
                padding: 24px 24px 16px 24px;
                border-bottom: 1px solid #f0f0f0;
            }
            
            .el-dialog__body {
                padding: 24px;
                max-height: 60vh;
                overflow-y: auto;
            }
            
            .el-dialog__footer {
                padding: 16px 24px 24px 24px;
                border-top: 1px solid #f0f0f0;
                background-color: #fafafa;
            }
            
            /* æ¡Œé¢ç«¯è¡¨å•ä¼˜åŒ– */
            .el-form-item {
                margin-bottom: 22px;
            }
            
            .el-form-item__label {
                font-weight: 500;
                color: #333;
            }
            
            .el-input__wrapper,
            .el-textarea__inner {
            border-radius: 6px;
            transition: all 0.3s;
        }
            
            .el-input__wrapper:hover,
            .el-textarea__inner:hover {
                border-color: #c0c4cc;
            }
            
            /* æ¡Œé¢ç«¯æŒ‰é’®ä¼˜åŒ– */
            .desktop-button-group .el-button {
                padding: 10px 24px;
                font-weight: 500;
                border-radius: 6px;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="header">
            <h1>ğŸš€ å¿«æ‰‹æé€Ÿç‰ˆç®¡ç†ç•Œé¢</h1>
            <p>è´¦å·ç®¡ç† | é…ç½®ç®¡ç† | è„šæœ¬æ‰§è¡Œ</p>
            <div style="margin-top: 10px;">
                <el-tag 
                    :type="networkStatus === 'connected' ? 'success' : networkStatus === 'connecting' ? 'info' : networkStatus === 'disconnected' ? 'warning' : 'danger'"
                    size="small"
                    style="font-size: 12px;">
                    {{ networkStatus === 'connected' ? 'ğŸŸ¢ å·²è¿æ¥' : networkStatus === 'connecting' ? 'ğŸŸ¡ è¿æ¥ä¸­' : networkStatus === 'disconnected' ? 'ğŸŸ  å·²æ–­å¼€' : 'ğŸ”´ è¿æ¥é”™è¯¯' }}
                </el-tag>
            </div>
        </div>

        <div class="container">
            <!-- çŠ¶æ€å¡ç‰‡ -->
            <div class="status-card">
                <el-row :gutter="20">
                    <el-col :span="6">
                        <el-statistic title="è´¦å·æ€»æ•°" :value="accounts.length" />
                    </el-col>
                    <el-col :span="6">
                        <el-statistic title="è„šæœ¬çŠ¶æ€" :value="scriptStatus" />
                    </el-col>
                    <el-col :span="6">
                        <el-statistic title="è¿è¡Œæ—¶é—´" :value="runningTime" suffix="ç§’" />
                    </el-col>
                    <el-col :span="6">
                        <el-button 
                            type="primary" 
                            :loading="isRunning" 
                            @click="runScript"
                            :disabled="accounts.length === 0"
                            style="width: 100%;">
                            {{ isRunning ? 'è¿è¡Œä¸­...' : 'å¼€å§‹æ‰§è¡Œ' }}
                        </el-button>
                    </el-col>
                </el-row>
            </div>

            <!-- æ ‡ç­¾é¡µ -->
            <el-tabs v-model="activeTab" type="card">
                <!-- è´¦å·ç®¡ç† -->
                <el-tab-pane label="è´¦å·ç®¡ç†" name="accounts">
                    <div class="status-card">
                        <div style="margin-bottom: 20px;">
                            <div style="display: flex; flex-direction: column; gap: 12px;">
                                <h3 style="margin: 0;">è´¦å·åˆ—è¡¨ ({{ accounts.length }} ä¸ª)</h3>
                                <div class="mobile-button-group">
                                <el-button type="primary" @click="showAddAccountDialog">
                                    æ·»åŠ è´¦å·
                                </el-button>
                                <el-button type="info" @click="importAccounts">
                                    å¯¼å…¥JSON
                                </el-button>
                                <el-button type="success" @click="exportAccounts">
                                    å¯¼å‡ºJSON
                                </el-button>
                                </div>
                            </div>
                        </div>

                        <!-- æ¡Œé¢ç«¯è¡¨æ ¼è§†å›¾ -->
                        <el-table :data="accounts" style="width: 100%" stripe class="mobile-table-card">
                            <el-table-column type="index" label="#" width="60" />
                            <el-table-column prop="remark" label="å¤‡æ³¨" width="150" show-overflow-tooltip class-name="remark-column">
                                <template #default="scope">
                                    <el-tag v-if="scope.row.remark" type="primary" size="default" 
                                        class="remark-tag"
                                        style="font-weight: bold; font-size: 13px; padding: 4px 12px; border-radius: 16px;">
                                        ğŸ“ {{ scope.row.remark }}
                                    </el-tag>
                                    <el-tag v-else type="info" size="small" style="color: #999; background: #f5f5f5; border: 1px dashed #ddd;">
                                        æ— å¤‡æ³¨
                                    </el-tag>
                                </template>
                            </el-table-column>
                            <el-table-column prop="salt" label="Salt" width="150" show-overflow-tooltip>
                                <template #default="scope">
                                    <span style="font-family: monospace; font-size: 13px; font-weight: 500;">{{ scope.row.salt }}</span>
                                </template>
                            </el-table-column>
                            <el-table-column prop="cookie" label="Cookie" min-width="200" show-overflow-tooltip>
                                <template #default="scope">
                                    <span style="font-family: monospace; font-size: 12px;">{{ scope.row.cookie }}</span>
                                </template>
                            </el-table-column>
                            <el-table-column prop="proxy" label="ä»£ç†" width="150" show-overflow-tooltip>
                                <template #default="scope">
                                    <el-tag v-if="scope.row.proxy" size="small">{{ scope.row.proxy }}</el-tag>
                                    <span v-else style="color: #999;">æ— ä»£ç†</span>
                                </template>
                            </el-table-column>
                            <el-table-column label="æ“ä½œ" width="200" fixed="right">
                                <template #default="scope">
                                    <el-button type="primary" size="small" @click="editAccount(scope.$index)" style="margin-right: 8px;">
                                        ç¼–è¾‘
                                    </el-button>
                                    <el-button type="danger" size="small" @click="deleteAccount(scope.$index)">
                                        åˆ é™¤
                                    </el-button>
                                </template>
                            </el-table-column>
                        </el-table>

                        <!-- ç§»åŠ¨ç«¯å¡ç‰‡è§†å›¾ -->
                        <div class="mobile-card-view">
                            <div v-if="accounts.length === 0" style="text-align: center; padding: 40px; color: #999;">
                                æš‚æ— è´¦å·æ•°æ®
                            </div>
                            <div v-for="(account, index) in accounts" :key="index" class="account-card">
                                <div class="account-card-header">
                                    <div style="display: flex; align-items: center; flex-wrap: wrap; gap: 8px;">
                                        <span style="font-weight: 600; color: #333; font-size: 14px;">#{{ index + 1 }}</span>
                                        <el-tag v-if="account.remark" type="primary" size="default" 
                                            class="remark-tag"
                                            style="font-weight: bold; font-size: 13px; padding: 6px 12px; border-radius: 20px; background: linear-gradient(135deg, #409EFF 0%, #67C23A 100%); border: none; color: white; box-shadow: 0 2px 8px rgba(64, 158, 255, 0.3);">
                                            ğŸ“ {{ account.remark }}
                                        </el-tag>
                                        <el-tag v-else type="info" size="small" 
                                            style="color: #999; background: #f5f5f5; border: 1px dashed #ddd; font-style: italic;">
                                            æ— å¤‡æ³¨
                                        </el-tag>
                                    </div>
                                </div>
                                <div class="account-card-content">
                                    <div><strong>Salt:</strong> <span style="font-family: monospace;">{{ account.salt }}</span></div>
                                    <div style="margin: 8px 0;">
                                        <strong>Cookie:</strong>
                                        <div style="font-family: monospace; background: #f8f9fa; padding: 6px; border-radius: 4px; margin-top: 4px; word-break: break-all; max-height: 60px; overflow-y: auto;">
                                            {{ account.cookie }}
                                        </div>
                                    </div>
                                    <div>
                                        <strong>ä»£ç†:</strong> 
                                        <el-tag v-if="account.proxy" size="small" style="margin-left: 4px;">{{ account.proxy }}</el-tag>
                                        <span v-else style="color: #999;">æ— ä»£ç†</span>
                                    </div>
                                </div>
                                <div class="account-card-actions">
                                    <el-button type="primary" size="small" @click="editAccount(index)" style="flex: 1;">
                                        ç¼–è¾‘
                                    </el-button>
                                    <el-button type="danger" size="small" @click="deleteAccount(index)" style="flex: 1;">
                                        åˆ é™¤
                                    </el-button>
                                </div>
                            </div>
                        </div>
                    </div>
                </el-tab-pane>

                <!-- é…ç½®ç®¡ç† -->
                <el-tab-pane label="é…ç½®ç®¡ç†" name="config">
                    <div class="status-card">
                        <h3>è„šæœ¬é…ç½®</h3>
                        <el-form :model="config" label-width="150px">
                            <el-form-item label="å¡å¯†(LX_KM)">
                                <el-input v-model="config.LX_KM" placeholder="è¯·è¾“å…¥å¡å¯†" />
                            </el-form-item>
                            <!-- <el-form-item label="ä¼˜åŒ–æ¨¡å¼(LX_YH)">
                                <el-switch v-model="config.LX_YH" />
                            </el-form-item>
                            <el-form-item label="å¼€å‘æ¨¡å¼">
                                <el-switch v-model="config.DEV_MODE" />
                            </el-form-item> -->
                            <el-form-item label="ä»»åŠ¡é»‘åå•">
                                <el-input v-model="config.LX_TASK_BLACKLIST" placeholder="ä¾‹å¦‚: sign,box,look,food" />
                            </el-form-item>
                            <el-form-item label="å¹¶å‘æ•°é‡">
                                <el-input-number v-model="config.MAX_CONCURRENCY" :min="1" :max="20" />
                            </el-form-item>
                            <el-form-item label="æç°æ—¶é—´(å°æ—¶)">
                                <el-input-number v-model="config.WITHDRAW_HOUR" :min="0" :max="23" />
                            </el-form-item>
                            <el-form-item label="æç°é‡‘é¢">
                                <el-input-number v-model="config.WITHDRAW_AMOUNT" :min="0" :precision="2" />
                            </el-form-item>
                            <el-form-item label="é‡‘å¸é˜ˆå€¼">
                                <el-input-number v-model="config.COIN_THRESHOLD" :min="0" />
                            </el-form-item>
                            <el-form-item>
                                <el-button type="primary" @click="saveConfig">ä¿å­˜é…ç½®</el-button>
                                <el-button @click="loadConfig">é‡æ–°åŠ è½½</el-button>
                            </el-form-item>
                        </el-form>
                    </div>
                </el-tab-pane>

                <!-- æ—¥å¿—æŸ¥çœ‹ -->
                <el-tab-pane label="æ‰§è¡Œæ—¥å¿—" name="logs">
                    <div class="status-card">
                        <div style="margin-bottom: 20px;">
                            <div style="display: flex; flex-direction: column; gap: 12px;">
                                <h3 style="margin: 0;">å®æ—¶æ—¥å¿—</h3>
                                <div class="mobile-button-group">
                                <el-button @click="clearLogs">æ¸…ç©ºæ—¥å¿—</el-button>
                                <el-button @click="testScript" type="success" :disabled="isRunning">æµ‹è¯•æ—¥å¿—</el-button>
                                <el-button @click="stopScript" type="danger" :disabled="!isRunning">åœæ­¢è„šæœ¬</el-button>
                                </div>
                            </div>
                        </div>
                        <div class="log-container" ref="logContainer">
                            <div v-for="(log, index) in logs" :key="index" class="log-line" :class="getLogClass(log)">
                                {{ log }}
                            </div>
                        </div>
                    </div>
                </el-tab-pane>
            </el-tabs>
        </div>

        <!-- æ·»åŠ /ç¼–è¾‘è´¦å·å¯¹è¯æ¡† -->
        <el-dialog 
            v-model="accountDialogVisible" 
            :title="editingIndex >= 0 ? 'ç¼–è¾‘è´¦å·' : 'æ·»åŠ è´¦å·'" 
            :width="isMobile ? '95%' : '650px'"
            :fullscreen="isMobile"
            :show-close="true"
            center>
            <el-form 
                :model="currentAccount" 
                :label-width="isMobile ? '60px' : '100px'" 
                :rules="accountRules" 
                ref="accountForm"
                :label-position="isMobile ? 'top' : 'right'">
                <el-form-item label="ğŸ“ å¤‡æ³¨" prop="remark">
                    <el-input 
                        v-model="currentAccount.remark" 
                        placeholder="è¯·è¾“å…¥è´¦å·å¤‡æ³¨ï¼ˆå¦‚ï¼šä¸»è´¦å·ã€æµ‹è¯•è´¦å·ç­‰ï¼‰"
                        clearable 
                        style="font-size: 14px;"
                        prefix-icon="Edit" />
                    <div style="font-size: 12px; color: #666; margin-top: 5px; display: flex; align-items: center; gap: 4px;">
                        <i class="el-icon-info" style="color: #409EFF;"></i>
                        <span>ğŸ’¡ å»ºè®®æ·»åŠ å¤‡æ³¨ä»¥ä¾¿äºåŒºåˆ†ä¸åŒè´¦å·ï¼ˆå¦‚ï¼šä¸»è´¦å·ã€å°å·ã€æµ‹è¯•è´¦å·ç­‰ï¼‰</span>
                    </div>
                </el-form-item>
                <el-form-item label="Salt *" prop="salt" required>
                    <el-input 
                        v-model="currentAccount.salt" 
                        placeholder="è¯·è¾“å…¥salt"
                        clearable />
                </el-form-item>
                <el-form-item label="Cookie *" prop="cookie" required>
                    <el-input 
                        v-model="currentAccount.cookie" 
                        type="textarea" 
                        :rows="isMobile ? 3 : 5" 
                        placeholder="è¯·è¾“å…¥cookie"
                        :autosize="{ minRows: 3, maxRows: 8 }"
                        resize="vertical" />
                </el-form-item>
                <el-form-item label="ä»£ç†" prop="proxy">
                    <el-input 
                        v-model="currentAccount.proxy" 
                        placeholder="ä¾‹å¦‚ï¼š127.0.0.1:1080 æˆ– user:pass@host:port"
                        clearable />
                    <div style="font-size: 12px; color: #999; margin-top: 5px;">
                        <i class="el-icon-info"></i>
                        å¯é€‰é…ç½®ï¼Œæ”¯æŒHTTP/HTTPS/SOCKS4/SOCKS5ä»£ç†
                    </div>
                </el-form-item>
            </el-form>
            <template #footer>
                <div :class="isMobile ? 'mobile-button-group' : 'desktop-button-group'" style="width: 100%;">
                    <el-button @click="accountDialogVisible = false" size="default">å–æ¶ˆ</el-button>
                    <el-button type="primary" @click="saveAccount" size="default">
                        {{ editingIndex >= 0 ? 'æ›´æ–°è´¦å·' : 'æ·»åŠ è´¦å·' }}
                    </el-button>
                </div>
            </template>
        </el-dialog>

        <!-- å¯¼å…¥å¯¹è¯æ¡† -->
        <el-dialog 
            v-model="importDialogVisible" 
            title="æ‰¹é‡å¯¼å…¥è´¦å·" 
            :width="isMobile ? '95%' : '750px'"
            :fullscreen="isMobile"
            center>
            <div style="margin-bottom: 20px;">
                <el-alert type="info" :closable="false">
                    <template #title>
                        <i class="el-icon-document"></i>
                        <strong>æ”¯æŒçš„å¯¼å…¥æ ¼å¼</strong>
                    </template>
                    <div style="margin-top: 12px; font-size: 13px; line-height: 1.6;">
                        <div style="margin-bottom: 8px;">
                            <strong>1. JSONæ ¼å¼ï¼š</strong>
                            <code style="background: #f5f5f5; padding: 2px 6px; border-radius: 3px; font-size: 12px;">
                                [{"salt":"xxx","cookie":"xxx","proxy":"xxx","remark":"xxx"}]
                            </code>
                        </div>
                        <div>
                            <strong>2. æ–‡æœ¬æ ¼å¼ï¼š</strong> ä¸€è¡Œä¸€ä¸ªè´¦å·ï¼Œå­—æ®µç”¨ <code>#</code> åˆ†éš”
                            <div style="margin-left: 16px; margin-top: 4px; font-size: 12px;">
                                <div>æ ¼å¼ï¼š<code>salt#cookie#proxy#å¤‡æ³¨</code></div>
                                <div style="color: #666;">ç¤ºä¾‹ï¼š<code>abc123#cookie_data_here#127.0.0.1:1080#ä¸»è´¦å·</code></div>
                            </div>
                        </div>
                    </div>
                </el-alert>
            </div>
            <el-input 
                v-model="importData" 
                type="textarea" 
                :rows="isMobile ? 8 : 14" 
                placeholder="è¯·ç²˜è´´è´¦å·æ•°æ®..."
                :autosize="{ minRows: 8, maxRows: 20 }"
                resize="vertical"
                style="font-family: 'Consolas', 'Monaco', 'Courier New', monospace;" />
            <template #footer>
                <div :class="isMobile ? 'mobile-button-group' : 'desktop-button-group'" style="width: 100%;">
                    <el-button @click="importDialogVisible = false" size="default">å–æ¶ˆ</el-button>
                    <el-button type="primary" @click="doImportAccounts" size="default">
                        <i class="el-icon-upload"></i>
                        å¼€å§‹å¯¼å…¥
                    </el-button>
                </div>
            </template>
        </el-dialog>
    </div>

    <script>
        const { createApp } = Vue;
        const { ElMessage, ElMessageBox } = ElementPlus;

        createApp({
            data() {
                return {
                    activeTab: 'accounts',
                    accounts: [],
                    config: {
                        LX_KM: '',
                        LX_YH: false,
                        DEV_MODE: false,
                        LX_TASK_BLACKLIST: '',
                        MAX_CONCURRENCY: 5,
                        WITHDRAW_HOUR: null,
                        WITHDRAW_AMOUNT: null,
                        COIN_THRESHOLD: null
                    },
                    logs: [],
                    isRunning: false,
                    scriptStatus: 'å¾…è¿è¡Œ',
                    runningTime: 0,
                    timer: null,
                    startTime: null,
                    
                    // å¯¹è¯æ¡†ç›¸å…³
                    accountDialogVisible: false,
                    importDialogVisible: false,
                    editingIndex: -1,
                    currentAccount: {
                        salt: '',
                        cookie: '',
                        proxy: '',
                        remark: ''
                    },
                    importData: '',
                    
                    // è¡¨å•éªŒè¯è§„åˆ™
                    accountRules: {
                        salt: [
                            { required: true, message: 'Saltä¸èƒ½ä¸ºç©º', trigger: 'blur' }
                        ],
                        cookie: [
                            { required: true, message: 'Cookieä¸èƒ½ä¸ºç©º', trigger: 'blur' }
                        ]
                    },
                    
                    // Socket.IOç›¸å…³
                    socket: null,
                    
                    // ç½‘ç»œçŠ¶æ€
                    networkStatus: 'connecting' // connecting, connected, disconnected, error
                };
            },
            computed: {
                // æ£€æµ‹æ˜¯å¦ä¸ºç§»åŠ¨ç«¯
                isMobile() {
                    return window.innerWidth <= 768;
                }
            },
            mounted() {
                this.loadAccounts();
                this.loadConfig();
                this.connectWebSocket();
                this.checkStatus(); // åˆå§‹çŠ¶æ€æ£€æŸ¥
                
                // å®šæœŸæ£€æŸ¥çŠ¶æ€åŒæ­¥
                this.statusCheckInterval = setInterval(() => {
                    this.checkStatus();
                }, 5000); // æ¯5ç§’æ£€æŸ¥ä¸€æ¬¡
                
                // ç›‘å¬çª—å£å¤§å°å˜åŒ–
                window.addEventListener('resize', this.handleResize);
            },
            beforeUnmount() {
                if (this.socket) {
                    this.socket.disconnect();
                }
                if (this.timer) {
                    clearInterval(this.timer);
                }
                if (this.statusCheckInterval) {
                    clearInterval(this.statusCheckInterval);
                }
                window.removeEventListener('resize', this.handleResize);
            },
            methods: {
                // å¤„ç†çª—å£å¤§å°å˜åŒ–
                handleResize() {
                    // å¼ºåˆ¶é‡æ–°è®¡ç®— computed å±æ€§
                    this.$forceUpdate();
                },
                
                // æ£€æŸ¥è„šæœ¬çŠ¶æ€
                async checkStatus() {
                    try {
                        const response = await axios.get('/api/status');
                        const statusData = response.data;
                        
                        // åŒæ­¥çŠ¶æ€
                        if (statusData.status !== this.scriptStatus) {
                            console.log(`çŠ¶æ€åŒæ­¥: ${this.scriptStatus} -> ${statusData.status}`);
                            this.scriptStatus = statusData.status;
                        }
                        
                        // åŒæ­¥è¿è¡ŒçŠ¶æ€
                        if (statusData.is_running !== this.isRunning) {
                            console.log(`è¿è¡ŒçŠ¶æ€åŒæ­¥: ${this.isRunning} -> ${statusData.is_running}`);
                            this.isRunning = statusData.is_running;
                            
                            if (!statusData.is_running && this.timer) {
                                this.stopTimer();
                            } else if (statusData.is_running && !this.timer) {
                                this.startTimer();
                            }
                        }
                    } catch (error) {
                        // é™é»˜å¤„ç†çŠ¶æ€æ£€æŸ¥é”™è¯¯ï¼Œé¿å…å¹²æ‰°ç”¨æˆ·
                        console.error('çŠ¶æ€æ£€æŸ¥å¤±è´¥:', error);
                    }
                },
                
                // é€šç”¨APIé”™è¯¯å¤„ç†æ–¹æ³•
                handleApiError(error, operation) {
                    let errorMessage = operation || 'æ“ä½œå¤±è´¥';
                    
                    if (error.response) {
                        // æœåŠ¡å™¨è¿”å›äº†é”™è¯¯å“åº”
                        const status = error.response.status;
                        const data = error.response.data;
                        console.log('HTTPé”™è¯¯å“åº”:', { status, data, operation });
                        
                        if (data && typeof data === 'object') {
                            errorMessage += `\nçŠ¶æ€ç : ${status}`;
                            if (data.error) {
                                errorMessage += `\né”™è¯¯: ${data.error}`;
                            }
                            if (data.message) {
                                errorMessage += `\næ¶ˆæ¯: ${data.message}`;
                            }
                            if (data.details) {
                                errorMessage += `\nè¯¦æƒ…: ${data.details}`;
                            }
                        } else if (typeof data === 'string') {
                            errorMessage += `\n${data}`;
                        } else {
                            errorMessage += `\nHTTP ${status} é”™è¯¯`;
                        }
                    } else if (error.request) {
                        // è¯·æ±‚å‘å‡ºä½†æ²¡æœ‰æ”¶åˆ°å“åº”
                        console.log('ç½‘ç»œé”™è¯¯:', error.request);
                        errorMessage += '\nç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œ';
                    } else {
                        // å…¶ä»–é”™è¯¯
                        console.log('å…¶ä»–é”™è¯¯:', error.message);
                        errorMessage += `\n${error.message}`;
                    }
                    
                    ElMessage.error(errorMessage);
                    return errorMessage;
                },
                
                // WebSocketè¿æ¥
                connectWebSocket() {
                    // ä½¿ç”¨Socket.IOå®¢æˆ·ç«¯
                    this.networkStatus = 'connecting';
                    this.socket = io();
                    
                    this.socket.on('connect', () => {
                        console.log('Socket.IOè¿æ¥å·²å»ºç«‹');
                        this.networkStatus = 'connected';
                        this.logs.push('ğŸ”— WebSocketè¿æ¥å·²å»ºç«‹');
                        this.$nextTick(() => {
                            this.scrollToBottom();
                        });
                    });
                    
                    this.socket.on('log', (data) => {
                        console.log('æ”¶åˆ°æ—¥å¿—:', data);
                        this.logs.push(data.message);
                        this.$nextTick(() => {
                            this.scrollToBottom();
                        });
                    });
                    
                    this.socket.on('status', (data) => {
                        console.log('æ”¶åˆ°çŠ¶æ€:', data);
                        this.scriptStatus = data.status;
                        
                        // æ ¹æ®çŠ¶æ€æ›´æ–°è¿è¡ŒçŠ¶æ€
                        if (data.status === 'å·²å®Œæˆ' || data.status === 'å·²åœæ­¢' || data.status === 'æ‰§è¡Œå¤±è´¥') {
                            this.isRunning = false;
                            this.stopTimer();
                        } else if (data.status === 'è¿è¡Œä¸­') {
                            this.isRunning = true;
                            if (!this.timer) {
                                this.startTimer();
                            }
                        }
                        
                        // æ·»åŠ çŠ¶æ€å˜åŒ–æ—¥å¿—
                        this.logs.push(`ğŸ“Š çŠ¶æ€æ›´æ–°: ${data.status}`);
                        this.$nextTick(() => {
                            this.scrollToBottom();
                        });
                    });
                    
                    this.socket.on('disconnect', () => {
                        console.log('Socket.IOè¿æ¥å·²æ–­å¼€');
                        this.networkStatus = 'disconnected';
                        this.logs.push('âš ï¸ WebSocketè¿æ¥å·²æ–­å¼€ï¼Œå°è¯•é‡è¿...');
                    });
                    
                    this.socket.on('connect_error', (error) => {
                        console.error('Socket.IOè¿æ¥é”™è¯¯:', error);
                        this.networkStatus = 'error';
                        this.logs.push('âŒ WebSocketè¿æ¥é”™è¯¯: ' + error.message);
                    });
                },
                
                // è´¦å·ç®¡ç†
                async loadAccounts() {
                    try {
                        const response = await axios.get('/api/accounts');
                        this.accounts = response.data;
                    } catch (error) {
                        console.error('åŠ è½½è´¦å·å¤±è´¥:', error);
                        this.handleApiError(error, 'åŠ è½½è´¦å·å¤±è´¥');
                    }
                },
                
                async saveAccounts() {
                    try {
                        await axios.post('/api/accounts', this.accounts);
                        ElMessage.success('è´¦å·ä¿å­˜æˆåŠŸ');
                    } catch (error) {
                        console.error('ä¿å­˜è´¦å·å¤±è´¥:', error);
                        this.handleApiError(error, 'ä¿å­˜è´¦å·å¤±è´¥');
                    }
                },
                
                showAddAccountDialog() {
                    this.editingIndex = -1;
                    this.currentAccount = { salt: '', cookie: '', proxy: '', remark: '' };
                    this.accountDialogVisible = true;
                },
                
                editAccount(index) {
                    this.editingIndex = index;
                    this.currentAccount = { ...this.accounts[index] };
                    this.accountDialogVisible = true;
                },
                
                async saveAccount() {
                    try {
                        await this.$refs.accountForm.validate();
                    
                    if (this.editingIndex >= 0) {
                        this.accounts[this.editingIndex] = { ...this.currentAccount };
                    } else {
                        this.accounts.push({ ...this.currentAccount });
                    }
                    
                    await this.saveAccounts();
                    this.accountDialogVisible = false;
                        ElMessage.success(this.editingIndex >= 0 ? 'è´¦å·æ›´æ–°æˆåŠŸ' : 'è´¦å·æ·»åŠ æˆåŠŸ');
                    } catch (error) {
                        if (error.message) {
                            ElMessage.error('ä¿å­˜å¤±è´¥: ' + error.message);
                        }
                        // éªŒè¯å¤±è´¥ä¸æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ï¼ŒElement Plusä¼šè‡ªåŠ¨æ˜¾ç¤º
                    }
                },
                
                async deleteAccount(index) {
                    try {
                        await ElMessageBox.confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè´¦å·å—ï¼Ÿ', 'ç¡®è®¤åˆ é™¤');
                        this.accounts.splice(index, 1);
                        await this.saveAccounts();
                        ElMessage.success('è´¦å·åˆ é™¤æˆåŠŸ');
                    } catch {
                        // ç”¨æˆ·å–æ¶ˆåˆ é™¤
                    }
                },
                
                importAccounts() {
                    this.importData = '';
                    this.importDialogVisible = true;
                },
                
                async doImportAccounts() {
                    try {
                        let newAccounts = [];
                        
                        // å°è¯•è§£æä¸ºJSON
                        try {
                            const parsed = JSON.parse(this.importData);
                            if (Array.isArray(parsed)) {
                                newAccounts = parsed;
                            } else {
                                throw new Error('ä¸æ˜¯æ•°ç»„æ ¼å¼');
                            }
                        } catch {
                            // è§£æä¸ºæ–‡æœ¬æ ¼å¼
                            const lines = this.importData.split('\n');
                            for (const line of lines) {
                                const trimmed = line.trim();
                                if (trimmed && !trimmed.startsWith('#')) {
                                    const parts = trimmed.split('#');
                                    if (parts.length >= 2) {
                                        newAccounts.push({
                                            salt: parts[0],
                                            cookie: parts[1],
                                            proxy: parts[2] || '',
                                            remark: parts[3] || ''
                                        });
                                    }
                                }
                            }
                        }
                        
                        if (newAccounts.length > 0) {
                            this.accounts = newAccounts;
                            await this.saveAccounts();
                            ElMessage.success(`æˆåŠŸå¯¼å…¥ ${newAccounts.length} ä¸ªè´¦å·`);
                            this.importDialogVisible = false;
                        } else {
                            ElMessage.error('æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„è´¦å·æ•°æ®');
                        }
                    } catch (error) {
                        ElMessage.error('å¯¼å…¥å¤±è´¥: ' + error.message);
                    }
                },
                
                exportAccounts() {
                    const dataStr = JSON.stringify(this.accounts, null, 2);
                    const dataBlob = new Blob([dataStr], {type: 'application/json'});
                    const url = URL.createObjectURL(dataBlob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = 'accounts.json';
                    link.click();
                    URL.revokeObjectURL(url);
                    ElMessage.success('è´¦å·æ•°æ®å·²å¯¼å‡º');
                },
                
                // é…ç½®ç®¡ç†
                async loadConfig() {
                    try {
                        const response = await axios.get('/api/config');
                        this.config = { ...this.config, ...response.data };
                    } catch (error) {
                        console.error('åŠ è½½é…ç½®å¤±è´¥:', error);
                        this.handleApiError(error, 'åŠ è½½é…ç½®å¤±è´¥');
                    }
                },
                
                async saveConfig() {
                    try {
                        await axios.post('/api/config', this.config);
                        ElMessage.success('é…ç½®ä¿å­˜æˆåŠŸ');
                    } catch (error) {
                        console.error('ä¿å­˜é…ç½®å¤±è´¥:', error);
                        this.handleApiError(error, 'ä¿å­˜é…ç½®å¤±è´¥');
                    }
                },
                
                // è„šæœ¬æ‰§è¡Œ
                async runScript() {
                    try {
                        this.isRunning = true;
                        this.scriptStatus = 'è¿è¡Œä¸­';
                        this.startTimer();
                        this.logs = [];
                        
                        const response = await axios.post('/api/run');
                        if (response.data.success) {
                            ElMessage.success('è„šæœ¬å·²å¼€å§‹æ‰§è¡Œ');
                        } else {
                            console.log('æœåŠ¡å™¨è¿”å›é”™è¯¯:', response.data);
                            throw new Error(response.data.error || response.data.message || 'æœªçŸ¥é”™è¯¯');
                        }
                    } catch (error) {
                        this.isRunning = false;
                        this.scriptStatus = 'æ‰§è¡Œå¤±è´¥';
                        this.stopTimer();
                        
                        const errorMessage = this.handleApiError(error, 'å¯åŠ¨è„šæœ¬å¤±è´¥');
                        this.logs.push(`âŒ ${errorMessage}`);
                    }
                },
                
                async testScript() {
                    try {
                        this.isRunning = true;
                        this.scriptStatus = 'è¿è¡Œä¸­';
                        this.startTimer();
                        this.logs = [];
                        
                        const response = await axios.post('/api/test');
                        if (response.data.success) {
                            ElMessage.success('æµ‹è¯•è„šæœ¬å·²å¼€å§‹æ‰§è¡Œ');
                        } else {
                            console.log('æœåŠ¡å™¨è¿”å›é”™è¯¯:', response.data);
                            throw new Error(response.data.error || response.data.message || 'æœªçŸ¥é”™è¯¯');
                        }
                    } catch (error) {
                        this.isRunning = false;
                        this.scriptStatus = 'æ‰§è¡Œå¤±è´¥';
                        this.stopTimer();
                        
                        const errorMessage = this.handleApiError(error, 'å¯åŠ¨æµ‹è¯•è„šæœ¬å¤±è´¥');
                        this.logs.push(`âŒ ${errorMessage}`);
                    }
                },
                
                async stopScript() {
                    try {
                        const response = await axios.post('/api/stop');
                        
                        // æ£€æŸ¥å“åº”æ•°æ®
                        if (response.data.success) {
                            this.isRunning = false;
                            this.scriptStatus = 'å·²åœæ­¢';
                            this.stopTimer();
                            ElMessage.success(response.data.message || 'è„šæœ¬å·²åœæ­¢');
                        } else {
                            // åç«¯è¿”å›äº†é”™è¯¯ï¼Œä½†HTTPçŠ¶æ€ç æ˜¯200
                            throw new Error(response.data.error || response.data.message || 'åœæ­¢è„šæœ¬å¤±è´¥');
                        }
                    } catch (error) {
                        console.error('åœæ­¢è„šæœ¬è¯·æ±‚å¤±è´¥:', error);
                        
                        // æ£€æŸ¥æ˜¯å¦æ˜¯HTTP 400é”™è¯¯ï¼ˆè„šæœ¬æœªåœ¨è¿è¡Œï¼‰
                        if (error.response && error.response.status === 400) {
                            const errorData = error.response.data;
                            if (errorData.error === 'è„šæœ¬æœªåœ¨è¿è¡Œ') {
                                // è„šæœ¬ç¡®å®æ²¡åœ¨è¿è¡Œï¼Œæ›´æ–°çŠ¶æ€ä½†ä¸æ˜¾ç¤ºé”™è¯¯
                                this.isRunning = false;
                                this.scriptStatus = 'å¾…è¿è¡Œ';
                                this.stopTimer();
                                ElMessage.info('è„šæœ¬å·²ç»åœæ­¢');
                                return;
                            }
                        }
                        
                        // å…¶ä»–é”™è¯¯æƒ…å†µ
                        this.handleApiError(error, 'åœæ­¢è„šæœ¬å¤±è´¥');
                    }
                },
                
                // æ—¥å¿—ç›¸å…³
                clearLogs() {
                    this.logs = [];
                },
                
                getLogClass(log) {
                    if (log.includes('âŒ') || log.includes('é”™è¯¯') || log.includes('å¤±è´¥')) {
                        return 'log-error';
                    } else if (log.includes('âš ï¸') || log.includes('è­¦å‘Š')) {
                        return 'log-warn';
                    } else if (log.includes('âœ…') || log.includes('æˆåŠŸ')) {
                        return 'log-success';
                    } else {
                        return 'log-info';
                    }
                },
                
                scrollToBottom() {
                    const container = this.$refs.logContainer;
                    if (container) {
                        container.scrollTop = container.scrollHeight;
                    }
                },
                
                // è®¡æ—¶å™¨ç›¸å…³
                startTimer() {
                    this.startTime = Date.now();
                    this.timer = setInterval(() => {
                        this.runningTime = Math.floor((Date.now() - this.startTime) / 1000);
                    }, 1000);
                },
                
                stopTimer() {
                    if (this.timer) {
                        clearInterval(this.timer);
                        this.timer = null;
                    }
                }
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>
